<!DOCTYPE html>
<html>
  <head>
    <title>Title</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }

      .image-50 img {
          width: 50%;
      }

      .image-75 img {
          width: 75%;
      }

    </style>
  </head>
  <body>
    <textarea id="source">

# docker-compose
![logo](https://raw.githubusercontent.com/docker/compose/master/logo.png)
1. Common docker problems
2. docker-compose to the rescue
3. pitfalls
4. live demo
---
# 1. Common docker Problems
## Multi Container apps are a hassle
* build images from Dockerfiles
* pull images from the hub or private registry
* start and stopping of containers
---
# 1. Common docker Problems
## Let's install selenium grid using docker:

### Pull images
```bash
$ docker pull selenium/hub && docker pull selenium/node-firefox && docker pull selenium/node-chrome
Using default tag: latest
latest: Pulling from selenium/hub
dde80f7d7068: Already exists
d61acf11302c: Pull complete
Digest: sha256:fc5015b58e11e880ffde69a44677c78b202269011a0c547553c41654648d0197
Status: Downloaded newer image for selenium/hub:latest
```
---
# 1. Common docker Problems
## Let's install selenium grid using docker:

### Start the hub:
```bash
docker run -d -P --name selenium-hub selenium/hub
```
### Link some nodes:
```bash
docker run -d --link selenium-hub:hub selenium/node-firefox
docker run -d --link selenium-hub:hub selenium/node-chrome
```
---
# 1. Common docker Problems
## Let's install selenium grid using docker
It works \o/

.image-75[![Default-aligned image](img/grid_via_docker.png)]

---
# 1. Common docker Problems

* how to start and  stop only certain services?
* how to restart entire stack?
* one has to do all the steps again!


        (╯°□°）╯︵ ┻━┻


* or write a script

### There has to be a better way!

---
# 2. docker-compose for the rescue
## Purpose

Docker Compose is for
* defining
* running

multi-container Docker applications

---
# 2. docker-compose for the rescue
## Installation
### OS
Available for:
* [Ubuntu](https://docs.docker.com/engine/installation/windows/)
* [MacOs](https://docs.docker.com/engine/installation/mac/)
* even [Windows](https://docs.docker.com/engine/installation/windows/)

### Requirements
You need docker. Make sure it's a current version:
```bash
$ docker -v
Docker version 1.11.2, build b9f10c9
```
---
# 2. docker-compose for the rescue
## Installation
### Let's fetch it
```bash
$ curl -L https://github.com/docker/compose/releases/download/1.6.2/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose
$ chmod +x /usr/local/bin/docker-compose
```

### Test run
```bash
$ docker-compose -v
docker-compose version 1.7.1, build 0a9ab35
```
---
# 2. docker-compose for the rescue
## docker-compose commands
```
$ docker-compose
Commands:
  build              Build or rebuild services
  config             Validate and view the compose file
  create             Create services
  down               Stop and remove containers, networks, images, and volumes
  events             Receive real time events from containers
  exec               Execute a command in a running container
  help               Get help on a command
  kill               Kill containers
  logs               View output from containers
  pause              Pause services
  port               Print the public port for a port binding
  ps                 List containers
  pull               Pulls service images
  restart            Restart services
  rm                 Remove stopped containers
  run                Run a one-off command
  scale              Set number of containers for a service
  start              Start services
  stop               Stop services
  unpause            Unpause services
  up                 Create and start containers
  version            Show the Docker-Compose version information
```

---
# 2. docker-compose for the rescue
## Commands you will need mostly

```bash
up                 Create and start containers
stop               Stop services
build              Build or rebuild services
```
---
# 2. docker-compose for the rescue
## Let's run it:
```bash
$ docker-compose up
ERROR:
        Can't find a suitable configuration file in this directory or any
        parent. Are you in the right directory?

        Supported filenames: docker-compose.yml, docker-compose.yaml
```

---
# 2. docker-compose for the rescue
##docker-compose.yml
* one file to define entire architecture
* yet two versions!

---
# 2. docker-compose for the rescue
## docker-compose.yml v1
### Build the selenium grid
```yml
hub:
    image: selenium/hub

firefox:
    image: selenium/node-firefox
    links:
        - hub
chrome:
    image: selenium/node-chrome
    links:
        - hub
```
---
```bash
$ docker-compose up -d
docker-compose -f grid.yml up -d
Creating helloworld_hub_1
Creating helloworld_chrome_1
Creating helloworld_firefox_1
```
---
# 2. docker-compose for the rescue
## docker-compose.yml v2
```yml
version: '2'

services:
    hub:
        image: selenium/hub
        ports:
            - 4444:4444
    firefox:
        image: selenium/node-firefox
        environment:
          - HUB_PORT_4444_TCP_ADDR=hub
        expose:
          - "5555"
    chrome:
        image: selenium/node-chrome
        environment:
          - HUB_PORT_4444_TCP_ADDR=hub
        expose:
          - "5555"
```
---
```bash
$ docker-compose up -d
docker-compose up -d
Creating helloworld_hub_1
Creating helloworld_chrome_1
Creating helloworld_firefox_1
```
---
# 2. docker-compose for the rescue
## Main difference between versions?

### syntax
* all services are defined under service key
* new volumes key

### networking
* on v2 every container can communciate with each other
* no linking necessary

### Which are we going to use?

* Let's use v2, right!?

---

# docker-compose and rancher
* docker-compse v2 support in progress for rancher
* planned for 1.2.0 milestone planned for October 2016
* there's an [issue on github](https://github.com/rancher/rancher/issues/3973)
.image-75[![rancher](img/rancher_issue.png)]

---
# 3. pittfalls
### Extending docker-compose files
* linked images are not extendable
* hence: duplication necessary
* one can also run multiple docker-compose.yml

### Pulling the latest tag
* if images will not be refeteched
* regulary `docker-compose pull`
---
# 3. pittfalls
### start vs up vs build
* starts only runs an exsting container
* up may (re)create a container, yet only build once
* build only builds the images
** sometimes build is necessary, hence if in doubt `docker-compose build`

### Disk space
* images eat space as if it was candy!
* [docker-clean](https://github.com/ZZROTDesign/docker-clean) is your friend

```bash
$ docker-clean
Cleaning images...
Images cleaned: 5
You've cleared approximately MB: 3598 or GB: 3 of space!
No dangling volumes!
Removing empty networks...
Networks removed: 2
```
---
### Live demo

Let's see it in action!
---
# Thank you!

Do you have any questions?
    </textarea>
    <script src="bower_components/remark/out/remark.min.js">
    </script>
    <script>
      var slideshow = remark.create();
    </script>
  </body>
</html>
